<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interview Performance | AI Career Coach</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Chart.js -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        teal: '#20C997',
                        navy: '#0d1b2a',
                        'navy-light': '#1b263b',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Outfit', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@700;800&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #000000 100%);
            color: #e2e8f0;
        }

        .font-display {
            font-family: 'Outfit', sans-serif;
        }

        .glass-sidebar {
            background: rgba(13, 27, 42, 0.6);
            backdrop-filter: blur(12px);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(32, 201, 151, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(32, 201, 151, 0.5);
        }

        /* Drawer Styles */
        .drawer {
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .drawer.drawer-open {
            transform: translateX(0);
        }
    </style>
</head>

<body class="h-screen flex overflow-hidden">

    <!-- SIDEBAR (Identical to Dashboard) -->
    <aside class="w-20 lg:w-64 glass-sidebar flex flex-col justify-between h-full z-20 transition-all duration-300">
        <!-- Logo -->
        <div class="h-20 flex items-center justify-center lg:justify-start lg:px-6 border-b border-white/5">
            <div
                class="w-10 h-10 bg-gradient-to-tr from-teal to-blue-600 rounded-xl flex items-center justify-center shrink-0 shadow-[0_0_15px_rgba(32,201,151,0.3)]">
                <span class="font-display font-bold text-white text-xl">AI</span>
            </div>
            <span class="hidden lg:block ml-3 font-display font-bold text-lg tracking-tight text-white">Career<span
                    class="text-teal">Coach</span></span>
        </div>

        <!-- Nav -->
        <nav class="flex-1 py-8 flex flex-col gap-2 px-2 lg:px-4">
            <a href="dashboard.html"
                class="flex items-center gap-4 px-4 py-3 text-gray-400 hover:text-white hover:bg-white/5 rounded-xl transition-all group">
                <i class="fas fa-grid-2 group-hover:text-teal transition-colors text-lg w-6 text-center"></i>
                <span class="hidden lg:block font-medium">Dashboard</span>
            </a>

            <a href="interview-history.html"
                class="flex items-center gap-4 px-4 py-3 text-white bg-white/10 rounded-xl transition-all group shadow-[0_0_10px_rgba(32,201,151,0.1)] border border-teal/20">
                <i class="fas fa-chart-line text-teal text-lg w-6 text-center"></i>
                <span class="hidden lg:block font-medium">Performance</span>
            </a>

            <!-- Other Links can be added here if needed -->
        </nav>

        <!-- User Profile -->
        <div class="p-4 border-t border-white/5">
            <div class="flex items-center gap-3 p-2 rounded-xl hover:bg-white/5 cursor-pointer transition-colors"
                onclick="logout()">
                <div
                    class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg">
                    <span id="user-initials" class="font-bold text-white text-sm">--</span>
                </div>
                <div class="hidden lg:block overflow-hidden">
                    <p id="user-name" class="text-sm font-bold text-white truncate">Loading...</p>
                    <p class="text-xs text-gray-400 truncate">Sign Out</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col h-full bg-slate-900/50 relative overflow-hidden">
        <!-- Background Glows -->
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0">
            <div
                class="absolute top-[-20%] right-[-10%] w-[800px] h-[800px] bg-teal/10 rounded-full blur-[120px] mix-blend-screen">
            </div>
            <div
                class="absolute bottom-[-20%] left-[-10%] w-[600px] h-[600px] bg-blue-600/10 rounded-full blur-[100px] mix-blend-screen">
            </div>
        </div>

        <!-- Header -->
        <header
            class="h-20 border-b border-white/5 flex items-center justify-between px-8 bg-slate-900/80 backdrop-blur-md z-10">
            <div>
                <h1 class="font-display font-bold text-2xl text-white tracking-tight">Interview <span
                        class="text-teal">Performance</span></h1>
                <p class="text-xs text-gray-400 mt-1">Track your progress and review past simulations</p>
            </div>
            <a href="app.html"
                class="bg-teal hover:bg-teal/80 text-navy font-bold px-6 py-2.5 rounded-xl transition-all shadow-[0_0_20px_rgba(32,201,151,0.4)] hover:shadow-[0_0_30px_rgba(32,201,151,0.6)] flex items-center gap-2">
                <i class="fas fa-microphone"></i>
                New Session
            </a>
        </header>

        <!-- Content Scroll Area -->
        <div class="flex-1 overflow-y-auto custom-scroll p-8 z-10">
            <div class="max-w-7xl mx-auto space-y-8">

                <!-- Chart Section -->
                <div class="glass-card rounded-2xl p-6 border border-white/10 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-teal to-blue-500"></div>
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="font-display font-bold text-xl text-white">Score Trajectory</h2>
                        <div class="flex items-center gap-4">
                            <span class="text-xs text-gray-400 uppercase tracking-widest font-bold">Overall Average:
                                <span id="global-average" class="text-teal text-lg ml-1">--</span></span>
                        </div>
                    </div>
                    <div class="h-[300px] w-full">
                        <canvas id="scoreChart"></canvas>
                    </div>
                </div>

                <!-- History Table Section -->
                <div class="glass-card rounded-2xl p-0 border border-white/10 overflow-hidden">
                    <div class="p-6 border-b border-white/5 flex items-center justify-between">
                        <h2 class="font-display font-bold text-xl text-white">Session History</h2>
                        <button id="refresh-btn" onclick="initHistoryPage()"
                            class="text-gray-400 hover:text-white transition-colors text-sm"><i
                                class="fas fa-sync-alt mr-1"></i> Refresh</button>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-white/5 text-gray-400 text-xs uppercase tracking-wider font-bold">
                                    <th class="p-4 border-b border-white/5">Date</th>
                                    <th class="p-4 border-b border-white/5">Role Target</th>
                                    <th class="p-4 border-b border-white/5">Company</th>
                                    <th class="p-4 border-b border-white/5 text-center">Score</th>
                                    <th class="p-4 border-b border-white/5 text-right"></th>
                                </tr>
                            </thead>
                            <tbody id="history-table-body" class="text-sm text-gray-300">
                                <!-- JS will populate this -->
                                <tr>
                                    <td colspan="5" class="p-8 text-center text-gray-500 italic">Loading history...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>

        <!-- DRAWER OVERLAY -->
        <div id="drawer-overlay" class="absolute inset-0 bg-black/50 backdrop-blur-sm z-20 hidden transition-opacity"
            onclick="closeDrawer()"></div>

        <!-- ACTION DRAWER -->
        <aside id="action-drawer"
            class="drawer absolute top-0 right-0 w-96 h-full glass-sidebar z-30 border-l border-white/10 flex flex-col items-center pt-8 px-6 shadow-2xl">
            <!-- Close Btn -->
            <button onclick="closeDrawer()"
                class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">
                <i class="fas fa-times text-xl"></i>
            </button>

            <!-- Drawer Content Placeholder -->
            <div id="drawer-content" class="w-full h-full flex flex-col">
                <div class="text-center mb-8">
                    <div
                        class="w-16 h-16 rounded-full bg-teal/10 flex items-center justify-center mx-auto mb-4 border border-teal/20">
                        <span id="drawer-score" class="text-2xl font-bold text-teal">--</span>
                    </div>
                    <h2 id="drawer-role" class="font-display font-bold text-xl text-white mb-1">Role Loading...</h2>
                    <p id="drawer-company" class="text-sm text-gray-400 uppercase tracking-widest">Company</p>
                    <p id="drawer-date" class="text-xs text-gray-500 mt-2">Date</p>
                </div>

                <div class="flex-1 space-y-3">
                    <h3
                        class="text-xs text-gray-400 font-bold uppercase tracking-wider mb-2 border-b border-white/5 pb-2">
                        Actions</h3>

                    <button id="btn-view-report" onclick=""
                        class="w-full bg-teal hover:bg-teal/80 text-navy font-bold py-3 rounded-xl transition-all flex items-center justify-center gap-2">
                        <i class="fas fa-file-alt"></i> View Full Report
                    </button>

                    <!-- Space grow -->
                    <div class="flex-1"></div>

                    <button id="btn-delete-session" onclick=""
                        class="w-full bg-red-500/10 hover:bg-red-500/20 text-red-400 hover:text-red-300 border border-red-500/20 font-bold py-3 rounded-xl transition-all flex items-center justify-center gap-2 mt-auto">
                        <i class="fas fa-trash"></i> Delete Session
                    </button>
                </div>
            </div>
        </aside>

    </main>

    <!-- Report Viewer Modal -->
    <div id="report-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">
        <div
            class="glass-card w-full max-w-4xl h-[90vh] flex flex-col rounded-2xl relative shadow-2xl border border-white/10 bg-[#0f172a]">

            <!-- Modal Header -->
            <div
                class="h-16 border-b border-white/10 flex items-center justify-between px-6 bg-[#0f172a] rounded-t-2xl">
                <h3 class="font-display font-bold text-xl text-white">Executive Report</h3>
                <button onclick="closeReportModal()"
                    class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-gray-400 hover:text-white transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Modal Content (Iframe for isolation or just Div) -->
            <div id="report-content" class="flex-1 overflow-y-auto custom-scroll p-8 text-gray-300">
                <!-- Report HTML Injected Here -->
            </div>

            <div
                class="h-16 border-t border-white/10 flex items-center justify-end px-6 gap-4 bg-[#0f172a] rounded-b-2xl">
                <button onclick="closeReportModal()"
                    class="text-gray-400 hover:text-white font-medium text-sm transition-colors">Close</button>
                <button onclick="printReport()"
                    class="bg-blue-600 hover:bg-blue-500 text-white px-5 py-2 rounded-lg font-bold text-sm transition-colors shadow-lg">Print
            </div>
        </div>
    </div>

    <!-- app.js removed to prevent variable conflicts -->

    <script>
        // --- SUPABASE SETUP ---
        const supabaseUrl = 'https://nvfjmqacxzlmfamiynuu.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im52ZmptcWFjeHpsbWZhbWl5bnV1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxMzk3MzAsImV4cCI6MjA4MDcxNTczMH0.W3J-E2ldrc99btVeChF0SauTQxr_48uFwImVaoHfOXI';

        // Initialize Supabase
        const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);
        // Bind to window for consistency if needed, though we use supabaseClient const here
        window.supabase = supabaseClient;

        let currentUser = null;

        document.addEventListener('DOMContentLoaded', async () => {
            // Init with loading state
            initHistoryPage();
        });

        async function initHistoryPage() {
            // AUTH CHECK
            const { data: { session } } = await supabaseClient.auth.getSession();

            if (!session) {
                window.location.href = '/index.html'; // Redirect to login
                return;
            }

            currentUser = session.user;

            // Update Profile in Sidebar
            updateUserProfile(session.user);

            // FETCH DATA
            await loadData(session.user.id);
        }

        async function loadData(userId) {
            try {
                const { data, error } = await supabaseClient
                    .from('interviews')
                    .select('id, created_at, overall_score, job_title, company, executive_report')
                    .eq('user_id', userId)
                    .order('created_at', { ascending: false }); // Newest first

                if (error) throw error;

                console.log("Fetched Interviews:", data);

                // Render
                renderTable(data);

                // For Chart, filter out null scores if necessary, but assume 0 is valid "bad" score
                let chartData = data.filter(d => d.overall_score !== null);
                renderChart(chartData);

            } catch (e) {
                console.error("Error loading history:", e);
                document.getElementById('history-table-body').innerHTML = `<tr><td colspan="5" class="p-8 text-center text-red-400">Error loading data: ${e.message}</td></tr>`;
            }
        }

        function updateUserProfile(user) {
            if (user.email) {
                const initials = user.email.substring(0, 2).toUpperCase();
                document.getElementById('user-initials').textContent = initials;
                document.getElementById('user-name').textContent = user.email;
            }
        }

        // --- CHART LOGIC ---
        let chartInstance = null;

        function renderChart(data) {
            const ctx = document.getElementById('scoreChart').getContext('2d');

            // Process Data: Reverse to show Oldest -> Newest left to right
            const sortedData = [...data].reverse();

            const labels = sortedData.map(d => new Date(d.created_at).toLocaleDateString(undefined, { month: 'short', day: 'numeric' }));
            const scores = sortedData.map(d => d.overall_score);

            if (chartInstance) chartInstance.destroy();

            // Create Gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(32, 201, 151, 0.5)'); // Teal
            gradient.addColorStop(1, 'rgba(32, 201, 151, 0.0)');

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Interview Score',
                        data: scores,
                        borderColor: '#20C997',
                        backgroundColor: gradient,
                        borderWidth: 3,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#20C997',
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(13, 27, 42, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#20C997',
                            borderColor: 'rgba(255,255,255,0.1)',
                            borderWidth: 1,
                            padding: 10,
                            displayColors: false,
                            callbacks: {
                                label: function (context) {
                                    return 'Score: ' + context.parsed.y + '/5';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });

            // Calculate Average
            const avg = scores.reduce((a, b) => a + b, 0) / scores.length;
            document.getElementById('global-average').textContent = (avg || 0).toFixed(1) + "/5";
        }

        // --- TABLE LOGIC ---
        let currentDataMap = {}; // store data for drawer lookup
        let selectedInterview = null; // Store currently selected interview for modal/print

        function renderTable(data) {
            const tbody = document.getElementById('history-table-body');
            tbody.innerHTML = '';
            currentDataMap = {};

            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="p-8 text-center text-gray-500">No interviews recorded yet.</td></tr>`;
                return;
            }

            data.forEach(item => {
                currentDataMap[item.id] = item; // Store for easy access

                const date = new Date(item.created_at).toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });

                // Handle Metadata (Fallback to old format if null)
                const role = item.job_title || "Unknown Role"; // Use new column or fallback
                const company = item.company || "Unknown Company";

                // Score Styles
                let scoreColor = "text-gray-400";
                if (item.overall_score >= 4) scoreColor = "text-teal font-bold";
                else if (item.overall_score >= 3) scoreColor = "text-yellow-500 font-bold";
                else scoreColor = "text-red-500 font-bold";

                const tr = document.createElement('tr');
                tr.className = "border-b border-white/5 hover:bg-white/5 transition-colors group cursor-pointer";
                tr.onclick = function () { openDrawer(item.id); }; // New: Open Drawer on Row Click

                tr.innerHTML = `
                <td class="p-4 text-gray-300 font-medium">${date}</td>
                <td class="p-4 text-white font-bold">${role}</td>
                <td class="p-4 text-gray-400 text-xs uppercase tracking-wide">${company}</td>
                <td class="p-4 text-center ${scoreColor} text-lg">${item.overall_score}</td>
                <td class="p-4 text-right">
                    <i class="fas fa-chevron-right text-gray-600 group-hover:text-teal transition-colors"></i>
                </td>
            `;
                tbody.appendChild(tr);
            });
        }

        // --- DRAWER LOGIC ---
        function openDrawer(id) {
            const item = currentDataMap[id];
            if (!item) return;

            selectedInterview = item; // Set Global

            // Populate Drawer
            document.getElementById('drawer-score').textContent = item.overall_score || "N/A";
            document.getElementById('drawer-role').textContent = item.job_title || "Unknown Role";
            document.getElementById('drawer-company').textContent = item.company || "Unknown Company";
            document.getElementById('drawer-date').textContent = new Date(item.created_at).toLocaleString();

            // Wire Buttons
            const reportBtn = document.getElementById('btn-view-report');
            reportBtn.onclick = function () {
                openReportModal();
            };

            const deleteBtn = document.getElementById('btn-delete-session');
            deleteBtn.onclick = function () { deleteSession(id); };

            // Show Drawer
            document.getElementById('drawer-overlay').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('action-drawer').classList.add('drawer-open');
            }, 10);
        }

        function closeDrawer() {
            document.getElementById('action-drawer').classList.remove('drawer-open');
            setTimeout(() => {
                document.getElementById('drawer-overlay').classList.add('hidden');
            }, 300);
        }

        async function deleteSession(id) {
            if (!confirm("Are you sure you want to delete this session? This cannot be undone.")) return;

            try {
                const { error } = await supabaseClient
                    .from('interviews')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                closeDrawer();
                loadData(currentUser.id); // Reload

            } catch (e) {
                alert("Error deleting session: " + e.message);
            }
        }

        // --- MODAL & PRINT LOGIC ---

        // Opens the on-screen modal with Dashboard (Dark) Theme
        window.openReportModal = function () {
            if (!selectedInterview) return;

            const container = document.getElementById('report-content');
            const dateStr = new Date(selectedInterview.created_at).toLocaleDateString();
            const score = selectedInterview.overall_score || "?";
            const role = selectedInterview.job_title || "Target Role";
            const company = selectedInterview.company || "Company";

            // 1. Inject Metadata Header (Dark Mode for Screen)
            const headerHTML = `
                <div class="mb-8 p-6 bg-white/5 rounded-xl border border-white/10">
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 class="text-2xl font-bold text-white mb-2 font-display">${role}</h2>
                            <div class="text-teal font-medium uppercase tracking-wider text-sm mb-1">${company}</div>
                            <div class="text-gray-400 text-sm"><i class="far fa-calendar-alt mr-2"></i> ${dateStr}</div>
                        </div>
                        <div class="text-right">
                             <div class="text-xs text-gray-400 uppercase tracking-widest mb-1">Overall Score</div>
                             <div class="text-4xl font-bold text-teal font-display">${score}<span class="text-lg text-gray-500">/5</span></div>
                        </div>
                    </div>
                </div>
            `;

            // 2. Load Content
            let reportBody = selectedInterview.executive_report || "<p class='text-gray-500'>No report content found.</p>";

            // APPLY CUSTOM STYLING TO HEADERS
            // Orange for Main Title
            reportBody = reportBody.replace(
                /(Final Executive Coaching Report)/gi,
                '<span class="text-orange-500">$1</span>'
            );

            // Yellow for Strengths
            reportBody = reportBody.replace(
                /(Key Strengths)/gi,
                '<span class="text-yellow-400">$1</span>'
            );

            // Red for Improvements
            reportBody = reportBody.replace(
                /(Areas for Improvement)/gi,
                '<span class="text-red-400">$1</span>'
            );

            container.innerHTML = headerHTML + reportBody;

            // 3. Show Modal
            document.getElementById('report-modal').classList.remove('hidden');
        }

        window.closeReportModal = function () {
            document.getElementById('report-modal').classList.add('hidden');
        }

        // Generates the PRINT-SPECIFIC layout (Black & White, Screenshot Match)
        window.printReport = function () {
            if (!selectedInterview) return;

            const dateStr = new Date(selectedInterview.created_at).toLocaleDateString();
            const score = selectedInterview.overall_score || "?";
            const role = selectedInterview.job_title || "Target Role";
            const company = selectedInterview.company || "Company";


            // Clean content logic
            let rawContent = selectedInterview.executive_report || "";

            // 1. Remove redundant "Final Executive Coaching Report" title (case insensitive)
            rawContent = rawContent.replace(/<[hH][1-6][^>]*>\s*Final Executive Coaching Report\s*<\/[hH][1-6]>/gi, "");

            // 2. Remove redundant "Overall Score" lines (generic match for safety)
            rawContent = rawContent.replace(/<[^>]+>\s*Overall Score:\s*[\d\.]+\s*\/\s*5\s*<\/[^>]+>/gi, "");
            rawContent = rawContent.replace(/Overall Score:\s*[\d\.]+\s*\/\s*5/gi, "");

            // 3. Add Dashed Line above "Areas for Improvement"
            rawContent = rawContent.replace(/(<[hH][1-6][^>]*>\s*Areas for Improvement\s*<\/[hH][1-6]>)/gi, '$1');

            // 4. Highlight Summary (Last Paragraph)
            const lastPIndex = rawContent.lastIndexOf('<p');
            if (lastPIndex !== -1) {
                const prefix = rawContent.substring(0, lastPIndex);
                const suffix = rawContent.substring(lastPIndex);
                rawContent = prefix + '<h4>Summary:</h4>' + suffix;
            }

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Interview Performance Report - ${dateStr}</title>
                        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
                        <style>
                            body {
                                font-family: 'Roboto', sans-serif;
                                color: #000;
                                padding: 30px 40px; /* Reduced padding */
                                max-width: 900px;
                                margin: 0 auto;
                            }
                            
                            /* TITLE */
                            h1.main-title {
                                text-align: center;
                                font-size: 24pt; /* Reduced size */
                                font-weight: 900;
                                margin-bottom: 20px; /* Reduced margin */
                                letter-spacing: -0.5px;
                            }
                            
                            /* METADATA GRID */
                            .meta-grid {
                                display: grid;
                                grid-template-columns: 2fr 1fr;
                                gap: 10px; /* Reduced gap */
                                margin-bottom: 15px; /* Reduced margin */
                                font-size: 10pt; /* Reduced font */
                                line-height: 1.4;
                            }
                            .meta-item { display: flex; }
                            .meta-label { font-weight: 700; width: 130px; }
                            
                            .score-box {
                                text-align: right;
                                font-size: 12pt;
                                font-weight: 700;
                            }
                            
                            /* DIVIDERS */
                            /* Removed dashed lines per user request */
                            
                            /* CONTENT OVERRIDES */
                            /* Headers */
                            h3, h4, .font-display {
                                font-size: 14pt; /* Reduced size */
                                font-weight: 700;
                                margin-top: 20px;
                                margin-bottom: 10px;
                                color: #000 !important;
                            }
                            
                            /* Body Text */
                            p, li, div {
                                font-size: 10pt; /* Reduced size */
                                line-height: 1.4; /* Tighter leading */
                                color: #000 !important;
                                margin-bottom: 8px; /* Consistent spacing */
                            }
                            
                            /* Lists */
                            ul { padding-left: 20px; margin-bottom: 10px; }
                            li { margin-bottom: 6px; }
                            
                            /* FORCE BLACK & WHITE / NO BACKGROUNDS */
                            * {
                                background-color: transparent !important;
                                background-image: none !important;
                                color: #000000 !important;
                                box-shadow: none !important;
                                text-shadow: none !important;
                                border-color: #000 !important; 
                            }
                            
                            body { background-color: #fff !important; }
                            .dashed-line { border-top: 1.5px dashed #000 !important; }
                            .bg-slate-800, .glass-card { border: none !important; padding: 0 !important; margin: 0 !important; }
                        </style>
                    </head>
                    <body>
                        <h1 class="main-title">Interview Performance Report</h1>
                        
                        <div class="meta-grid">
                            <div>
                                <div class="meta-item"><span class="meta-label">Company Name:</span> ${company.toUpperCase()}</div>
                                <div class="meta-item"><span class="meta-label">Target Position:</span> ${role.toUpperCase()}</div>
                                <div class="meta-item"><span class="meta-label">Interview Date:</span> ${dateStr}</div>
                            </div>
                            <div class="score-box">
                                Overall Score: ${score} / 5
                            </div>
                        </div>
                        
                        <!-- Removed dashed line here -->
                        
                        <!-- INJECTED REPORT CONTENT -->
                        <div class="report-body">
                            ${rawContent}
                        </div>
                    </body>
                </html >
            `);
            printWindow.document.close();
            setTimeout(() => { printWindow.print(); }, 800);
        }

        // Auth Logout
        window.logout = async function () {
            if (supabaseClient) await supabaseClient.auth.signOut();
            window.location.href = '/index.html';
        }

    </script>
</body>

</html>